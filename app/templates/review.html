<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>Revisión de consulta</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/app-ui.css') }}">
</head>
<body>
  <header class="app-header" role="banner" aria-label="Barra superior">
    <img
      class="pc-logo"
      src="https://mi-bucket-milito.s3.us-east-1.amazonaws.com/Captura+de+pantalla+2025-07-19+a+la(s)+10.57.00%E2%80%AFp.%C2%A0m..png"
      alt="PX"
      width="38" height="38"
      decoding="async"
      fetchpriority="high">
    <h1 class="app-title">Revisión de la consulta</h1>
  </header>

  <main class="review-wrap" role="main">
    <section class="card" aria-labelledby="resumen-final">
      <h2 id="resumen-final">Resumen final</h2>
      <pre class="json" aria-label="JSON del resumen final">{{ final_summary | tojson(indent=2) }}</pre>
      <p><strong>Hash del contenido:</strong> {{ content_sha256 }}</p>
    </section>

    <!-- Formulario para confirmar y guardar -->
    <form method="post" action="{{ url_for('routes.aceptar') }}" class="actions">
      {{ csrf_token() if csrf_token is defined }}

      <!-- Identificación / trazabilidad -->
      <input type="hidden" name="tx_id" value="{{ tx_id | e }}">
      <input type="hidden" name="encounter_started_at" value="{{ encounter_started_at | e }}">
      <input type="hidden" name="clinician_name" value="{{ clinician_name | e }}">
      <input type="hidden" name="clinician_license" value="{{ clinician_license | e }}">
      {% if patient_dni %}<input type="hidden" name="patient_dni" value="{{ patient_dni | e }}">{% endif %}

      <!-- Snapshot e integridad -->
      <input type="hidden" name="content_sha256" value="{{ content_sha256 | e }}">
      <input type="hidden" name="associated_json" value='{{ assoc_list | tojson }}'>

      <input type="hidden" name="final_summary_json" value='{{ final_summary | tojson }}'>


      <!-- Botones -->
      <button type="button" class="btn" onclick="history.back()">← Volver a editar</button>
      <button type="submit" class="btn primary">Aceptar y guardar</button>
    </form>
  </main>
</body>
</html>

